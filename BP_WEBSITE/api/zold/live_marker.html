<!DOCTYPE html>
<html>
  <head>
<title>Simple Map</title>
<meta name="viewport" content="initial-scale=1.0">
<meta charset="utf-8">
<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    height: 100%;
  }
</style>

<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
<script src="https://www.gstatic.com/firebasejs/3.6.0/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-messaging.js"></script>

<script>
  // Initialize Firebase
  var config = {
     apiKey: "AIzaSyBQchZ2V6xpY-SgQ9Z20-wFsL4xDx-Rw3w",
    authDomain: "busplanner-f496d.firebaseapp.com",
    databaseURL: "https://busplanner-f496d.firebaseio.com",
    storageBucket: "busplanner-f496d.appspot.com",
    messagingSenderId: "771650212189"
  };
  firebase.initializeApp(config);



firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
        console.log ("logged");
        email = user.email;
        console.log (email);    
    } else {
        console.log ("Not logged");
    }
});

function initMap() {
          var map = new google.maps.Map(document.getElementById('map'), {
            center: {
              lat: 13.181,
              lng: 74.941
            },
            zoom: 14,
            styles: [{
              featureType: 'poi',
              stylers: [{
              visibility: 'on'
            }] // Turn off points of interest.
            }, {
              featureType: 'transit.station',
              stylers: [{
              visibility: 'on'
            }] // Turn off bus stations, train stations, etc.
            }],
            disableDoubleClickZoom: false
          });


        firebase.database().ref('users').on('value', function(snapshot) {
            var msg = snapshot.val();
            for (i in msg) {
                firebase.database().ref('users/' + i +"/vehicles").on('value', function(snapshot) {
                    var gig = snapshot.val();

                    console.log ("Inside the for loop");
                    var latLng = new google.maps.LatLng(gig.latitude,
                                gig.longitude);
                    var marker = new google.maps.Marker({
                            position: latLng,
                        map: map
                    });
                });
            }
            console.log (msg)
        });

    }
    google.maps.event.addDomListener(window, "load", initMap);
</script>
  </head>
  <body>
<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHNVxKQAn4wn4sqz_1i5yKIBenoiyWU5I&&libraries=visualization&callback=initMap"
async defer></script>
  </body>
</html>